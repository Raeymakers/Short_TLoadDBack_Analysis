---
title: "PVT_VAS-f_analysis"
author: "Sofie Raeymakers"
date: "5/3/2022"
output: html_document
---

```{r setup, include=FALSE}
rm(list = ls()) # Clear environment
cat("\014") # Clear console
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning = FALSE}
##### Set environment #####

library(tidyverse)

# Get and declare functions
#Set working directory to the folder in which all CSV files are located

setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
source("C:/Users/ASUSTeK/OneDrive/Documenten/Github/Short_TLoadDBack/functions.R") # This is a file in the same directory where you can stash your functions so you can save them there and have them together

Dir = "C:/Users/ASUSTeK/OneDrive/Documenten/Github/Short_TLoadDBack/Data/"
setwd(Dir)

#Download PVT data (this datafile is made in 'preprocessing')
PVT <- read.csv(paste0(Dir, "PVT.csv"), header = TRUE, sep = )

#Download VAS-f data
VAS <- read.csv(paste0(Dir, "VAS.csv"), header = TRUE, sep = )
#VAS has 'quantised: 1-11 instead of 0-10

#Download EXP data
EXP <- read.csv(paste0(Dir, "EXP.csv"), header = TRUE, sep = )

```

```{r}
### CHECKING TLOADNBACK#

# count 'accuracy' (0 or 1) in LCL vs HCL
sum(EXP$accuracy[EXP$Condition=="HCL"])
sum(EXP$accuracy[EXP$Condition=="LCL"])
mean(EXP$accuracy[EXP$Condition=="HCL"])
mean(EXP$accuracy[EXP$Condition=="LCL"])

EXP$Day <- factor(EXP$Day)
EXP$Condition <- factor(EXP$Condition)

#do this with shihny!!
three_way_acc <-lm(accuracy~Condition * Day, data=EXP)
one_way_acc <- lm(accuracy~Condition , data=EXP)
summary(three_way_acc)
summary(one_way_acc)
library(effects)
plot(one_way_acc)

three_way_prop <- lm(prop_correct~Condition * Day, data=EXP)
one_way_prop <- lm(prop_correct~Condition, data=EXP)
summary(three_way_prop)
summary(one_way_prop)


#visualise
library(emmeans)
emmeans1 <- emmeans(fit, pairwise ~ Condition | Day, adjust ="fdr", type = "response")
two_way_emm <- summary(emmeans1)$emmeans

emmeans2 <- emmeans(fit, pairwise ~ Condition, adjust ="fdr", type = "response")
one_way_emm <- summary(emmeans2)$emmeans

  
plot <- one_way_plotf(EXP, one_way_emm, "prop_correct")

plot <- two_way_plotf(EXP, two_way_emm, "prop_correct")


```

```{r}
#### CLEANING PVT ####

#Dataframe from day 1
PVT1 <- PVT[!(PVT$Day==2),]

library(reshape2)
library(cowplot)

#plot reaction times with raincloudplot
d<-melt(data.frame(rt=c(PVT1$RT))) # we melt to wide format 
ggplot(d, aes(x = variable, y = value, fill=variable))+
  geom_flat_violin(position = position_nudge(x = .2, y = 0),adjust =2)+
  ylab('rt')+xlab('amount')+coord_flip()+theme_cowplot()+
  geom_point(position=position_jitter(width=.15), size=2)+
  geom_boxplot(width= .10, outlier.shape = NA)+
  theme(legend.position="none")+
  ggtitle("reaction times with outliers")

summary(PVT1$RT)
hist(PVT1$RT,
     xlab = "RT",
     main = "Histogram of RT",
     breaks = sqrt(nrow(PVT1)))

print('upper 97.5% bound')
quantile (PVT1$RT, 0.975)


# remove RT over 2000 millisec
PVT1 <- subset(PVT1, RT < 3800)
d<-melt(data.frame(rt=c(PVT1$RT)))
ggplot(d, aes(x = variable, y = value, fill=variable))+
  geom_flat_violin(position = position_nudge(x = .2, y = 0),adjust =2)+
  geom_point(position=position_jitter(width=.15), size=0.25)+
  ylab('rt')+xlab('amount')+coord_flip()+theme_cowplot()+
  geom_boxplot(width= .10, outlier.shape = NA)+
  theme(legend.position="none")+
  guides(fill=FALSE)+
  ggtitle("reaction times < 3800 millisec")

summary(PVT1$RT)
hist(PVT1$RT,
     xlab = "RT",
     main = "Histogram of RT",
     breaks = sqrt(nrow(PVT1)))


out<-boxplot.stats(PVT1$RT)$out#outliers
out_ind<-which(PVT1$RT %in% c(out))#row numbers that contain outliers
boxplot(PVT1$RT, ylab='rt') #boxplot
mtext(paste('boxplot with outliers')) #boxplot with outliers


#remove outliers: sign that they were not paying attention
outliers <- boxplot(PVT1$RT, plot=FALSE)$out
PVT1<- PVT1[-which(PVT1$RT %in% outliers),]



# check normality of PVT1 RT
library("car")
qqPlot(PVT1$RT)

# log transform data
PVT1$RT = log(PVT1$RT)

qqPlot(PVT1$RT)






### Do like Borrogan : mean 1/RT

PVT$RT <- 1/(PVT$RT/1000) #1/RT

# we have 97 iDs. Each participant is in either LCL or HCL
for (i in 1:97) {
  PVT$MeanRT[PVT$ID==i & PVT$Test==1 & PVT$Day==1]= mean (PVT$RT[PVT$ID==i & PVT$Test==1 & PVT$Day==1])
  PVT$MeanRT[PVT$ID==i & PVT$Test==2 & PVT$Day==1]= mean (PVT$RT[PVT$ID==i & PVT$Test==2 & PVT$Day==1])
  PVT$MeanRT[PVT$ID==i & PVT$Test==1 & PVT$Day==2]= mean (PVT$RT[PVT$ID==i & PVT$Test==1 & PVT$Day==2])
  PVT$MeanRT[PVT$ID==i & PVT$Test==2 & PVT$Day==2]= mean (PVT$RT[PVT$ID==i & PVT$Test==2 & PVT$Day==2])
  }

PVT <- PVT[!duplicated(PVT$MeanRT), ]

length(unique(PVT$MeanRT))
#388
97*4

glimpse(PVT)


#plot reaction times with raincloudplot
d<-melt(data.frame(rt=c(PVT$MeanRT))) # we melt to wide format 
ggplot(d, aes(x = variable, y = value, fill=variable))+
  geom_flat_violin(position = position_nudge(x = .2, y = 0),adjust =2)+
  ylab('MeanRT')+xlab('amount')+coord_flip()+theme_cowplot()+
  geom_point(position=position_jitter(width=.15), size=2)+
  geom_boxplot(width= .10, outlier.shape = NA)+
  theme(legend.position="none")+
  ggtitle("reaction times with outliers")

summary(PVT$MeanRT)
hist(PVT$MeanRT,
     xlab = "MeanRT",
     main = "Histogram of MeanRT",
     breaks = sqrt(nrow(PVT)))

qqPlot(PVT$MeanRT)


```

```{r}

# make factors
PVT$Day <- factor(PVT$Day)
PVT$Test <- factor(PVT$Test)
PVT$Condition <- factor(PVT$Condition)

levels(PVT$Condition)

formula <- lm( x + y + 1|ID)

# summarize data per group
library(dplyr)
sum <- group_by(PVT, Condition, Test, Day) %>%
  summarise(
    count = n(),
    mean = mean(RT, na.rm = TRUE),
    sd = sd(RT, na.rm = TRUE)
  )
sum


library(ggplot2)
ggplot(sum, aes(x=Condition, y=mean)) + 
  geom_violin()
ggplot(PVT1, aes(x=Condition, y=RT)) + 
  geom_violin()

library("ggpubr")
ggboxplot(PVT1, x = "Condition", y = "RT", 
          color = "Condition", palette = c("#00AFBB", "#E7B800", "#FC4E07"),
          ylab = "RT", xlab = "Condition")

ggplot(PVT1, aes(x = Condition, 
                     y = RT, 
                     color=Test)) +
  geom_point() +
  labs(title = "this is the title")

#plot reaction times with raincloudplot
library(reshape2)
library(cowplot)
d<-melt(data.frame(RT=c(PVT1$RT))) # we melt to wide format 
ggplot(d, aes(x = variable, y = value, fill=variable))+
  geom_flat_violin(position = position_nudge(x = .2, y = 0),adjust =2)+
  ylab('RT')+xlab('amount')+coord_flip()+theme_cowplot()+
  geom_point(position=position_jitter(width=.15), size=2)+
  geom_boxplot(width= .10, outlier.shape = NA)+
  theme(legend.position="none")+
  ggtitle("reaction times with outliers")

# calculate mean RT PER PARTICIPANT 
aggdf <- aggregate (RT ~ ID , PVT, mean)
names(aggdf)[2] <- "Mean_RT_Participant"
PVT <- merge(PVT1, aggdf, by="ID")

aggdf <- aggregate (RT ~ Day * Condition * ID , PVT, mean)
names(aggdf)[2] <- "Mean_RT"


aggregate(ID ~ Condition, #Data column group by period
            data = PVT1, 
            FUN = function(x) length(unique(x)))




```